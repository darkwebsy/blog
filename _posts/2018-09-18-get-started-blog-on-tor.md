---
layout: post
title:  "Tor(ãƒ‡ã‚£ãƒ¼ãƒ—ã‚¦ã‚§ãƒ–/ãƒ€ãƒ¼ã‚¯ã‚¦ã‚§ãƒ–)ã«ãƒ–ãƒ­ã‚°ã‚’ä½œæˆã™ã‚‹æ–¹æ³•"
date:   2018-09-18 09:00:00 +0900
categories: blog
---


ãƒãƒ­ãƒ¼çš†ã•ã‚“ã€‚ã‚¹ã‚«ãƒ¼ãƒ¬ãƒƒãƒˆã§ã™ã€‚

ä»Šå›ã¯çš†ã•ã‚“çŸ¥ã‚ŠãŸã„ã ã‚ã†ãªãƒ¼ã£ã¦ã„ã†ã€Torã«ãƒ–ãƒ­ã‚°ã¨ã‹ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã‚’ä½œæˆã™ã‚‹æ–¹æ³•ã‚’æ•™ãˆã¦ã‚ã’ãŸã„ã¨æ€ã„ã¾ã™ã€‚

ä»Šã“ã®è¨˜äº‹ãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹ã“ã®ã‚µã‚¤ãƒˆã‚‚ã€ãŠãã‚‰ãã§ã™ãŒï¼ä»Šå›ã”ç´¹ä»‹ã™ã‚‹ã‚„ã‚Šæ–¹ã§ä½œæˆã•ã‚ŒãŸã‚‚ã®ã«ãªã£ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚ã®ã§ï¼ã”å‚ç…§é ‚ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ãƒ¼ã€‚

## å°å…¥ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨åŒ¿åæ€§ã®å•é¡Œ

ä»Šå›ç´¹ä»‹ã™ã‚‹æ–¹æ³•ã§ã¯ã€ç’°å¢ƒã¨ã—ã¦ã€

* ubuntu 18.04
* nginx
* jekyll

ã‚’ãƒ¡ã‚¤ãƒ³ã¨ã—ã¦ä½¿ã£ã¦ã„ã¾ã™ã€‚

ä½•æ•…ã“ã®æ§‹æˆãªã®ã‹ã¨ã„ã†ã¨ã€ç°¡å˜ã ã‹ã‚‰ã§ã™ã€‚ãã‚Œã ã‘ã§ã™ã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çš„ã«ã‚‚ã€å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

### ãªãœubuntuãªã®ã‹

ç°¡å˜ã ã‹ã‚‰ã§ã™ã€‚

æœ¬éŸ³ã‚’è¨€ã†ã¨ã€ä¸€ç•ªå®‰å…¨ãªã®ã¯whonixã§ã™ã€‚ç¶šã„ã¦debianã§ã™ã€‚

ubuntuã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚‚ç°¡å˜ã ã—ã€æƒ…å ±ã‚‚å¤šã„ã—ã€ãã‚‚ãã‚‚HTMLãƒšãƒ¼ã‚¸è¦‹ã›ã‚‹ãã‚‰ã„ã ã£ãŸã‚‰ã‚ã‚“ã¾å•é¡Œãªã„ã§ã™ã€‚æ°—ã«ã—ãªãã¦ğŸ‘

### ãªãœnginxãªã®ã‹

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã‹ãƒãƒƒã‚­ãƒ³ã‚°æ”»æ’ƒã«å¼·ã„ã‹ã‚‰ã§ã™ã€‚
apacheã˜ã‚ƒãªãã¦nginxã«ã—ã¾ã—ã‚‡ã†ã­ã€‚

### ãªãœjekyllãªã®ã‹

jekyllã¨ã¯ã€é™çš„HTMLã‚µã‚¤ãƒˆã‚’ç”Ÿæˆã™ã‚‹Rubyã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

ãªãœWordPressã§ã¯ãªãã€jekyllãªã®ã‹ã€‚ã§ã™ãŒã€

å˜ç´”ã«WordPressã¯è„†å¼±æ€§å•é¡ŒãŒå¤šã„ã‹ã‚‰ã§ã™ã€‚

ãã‚Œã«ã€å‹•çš„ã‚µã‚¤ãƒˆãŒã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ãŒã‚ã‚‹ãŸã‚ã€ã‚ªã‚¹ã‚¹ãƒ¡ã§ãã¾ã›ã‚“ã®ã§ã™ã€‚

HTMLãƒšãƒ¼ã‚¸ã‚’ã„ã¡ã„ã¡ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ãæ–¹æ³•ãŒä¸€ç•ªãªã‚“ã§ã™ã­ã€‚

### ãªãœVPSã‚„æœ‰æ–™ã®ã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ã‚ãªã„ã®ã‹

Torã®hidden serviceã‚’ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã—ã¦ãã‚Œã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã¯ãŸãã•ã‚“ã‚ã‚Šã€ãã‚Œã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚‚å¤šã„ã§ã™ã­ã€‚
ã—ã‹ã—ãã‚Œã‚’åˆ©ç”¨ã—ãªã„ç†ç”±ã¯ä½•ã§ã—ã‚‡ã†ã‹ã€‚

* ãŠé‡‘ãŒã‹ã‹ã‚‹
* æ”¯æ‰•ã„ã«åˆ©ç”¨ã™ã‚‹ãƒ“ãƒƒãƒˆã‚³ã‚¤ãƒ³ã«é–¢ã™ã‚‹å¹…åºƒã„çŸ¥è­˜ãŒå¿…è¦
* ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã—ã¦ã„ã‚‹ã‚µãƒ¼ãƒãƒ¼ãŒãƒãƒƒã‚­ãƒ³ã‚°ã•ã‚Œã‚‹ã¨è‡ªåˆ†ã®ã‚µã‚¤ãƒˆã‚‚è¢«å®³ã‚’å—ã‘ã‚‹
* ãã‚‚ãã‚‚å¤§æ‰‹ã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ãŒæ½°ã‚ŒãŸã‚Šã—ã¦ã„ã¦ä¿¡ç”¨ã«å€¤ã™ã‚‹ã‚µã‚¤ãƒˆãŒå°‘ãªã„

ã¨ã„ã£ãŸã¨ã“ã‚ã§ã™ã€‚

## æœ¬é¡Œ Ubuntu 18.04 nginx jekyllã§Torã«ãƒ–ãƒ­ã‚°ã‚’ä½œæˆã™ã‚‹æ–¹æ³•

ã¾ãšã¯ã€‚ubuntu 18.04ã‚’virtualboxã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ã‚‡ã†ã­ã€‚ã“ã‚Œã¯èª¿ã¹ã¦ã­ã€‚

SSHã§ä½œæ¥­ã—ã¦ã„ãã‹ã‚‰ã€`sudo apt install openssh-server`ã—ã¨ã“ã†ã­ã€‚

[Create a Tor Website on Ubuntu â€“ TheCloud.org.uk](https://thecloud.org.uk/create-tor-hidden-service-website-ubuntu-linux/)ãŒã¨ã¦ã‚‚ã‚ã‹ã‚Šæ˜“ã‹ã£ãŸã‚ˆï¼ã“ã®è¨˜äº‹ã‚’ç°¡æ½”ã«ã”ç´¹ä»‹ã™ã‚‹ã­ã€‚

ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼nginxã®è¨­å®šã‚’ã™ã‚‹ã‚ˆï¼

```sh
# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt install nginx

# ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã¾ã‚‹ã”ã¨æ›¸ãæ›ãˆï¼
cat > /etc/nginx/sites-available/default
server {
       listen 127.0.0.1:8080 default_server;
       server_name localhost;
       root /usr/share/nginx/html;
       index index.html index.htm;
       location / {
               allow 127.0.0.1;
               deny all;
       }
}

```

`lsb_release -a`ã§ubuntuã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèªã—ã‚ˆã†ã€‚

> Then visit this link and select your Linux version and codename from the drop down menu.

æ¬¡ã«ã€[Tor Project: Debian/Ubuntu Instructions](https://www.torproject.org/docs/debian.html.en#ubuntu)ã¸è¡Œã£ã¦ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã”ã¨ã®Torã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã‚’ç¢ºèªã—ã¦ã¿ã‚ˆã†ã€‚

ä»Šå›ã¯ã€Ubuntu 18.04ã®å ´åˆã‚’ç´¹ä»‹ã™ã‚‹ã‚ˆã€‚

```sh
# ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½è¨˜ï¼
cat >> /etc/apt/sources
deb https://deb.torproject.org/torproject.org bionic main
deb-src https://deb.torproject.org/torproject.org bionic main

# rootã§ä½œæ¥­ã™ã‚‹ã‚ˆ
sudo su -
gpg2 --recv A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89
gpg2 --export A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89 | apt-key add -

apt update
apt install tor deb.torproject.org-keyring

```

torrcã«è¿½è¨˜

```sh
sudo nano /etc/tor/torrc

HiddenServiceDir /var/lib/tor/hidden_service/
HiddenServicePort 80 127.0.0.1:8080
```

æœ€å¾Œï¼

```sh
sudo service nginx restart
sudo service tor restart

cat /var/lib/tor/hidden_service/hostname
```

ãƒ‰ãƒ¡ã‚¤ãƒ³åãŒå‡ºåŠ›ã•ã‚Œã¾ã—ãŸã‹ï¼Ÿã“ã‚Œã‚’Torã«å…¥åŠ›ã—ã¦ãƒšãƒ¼ã‚¸ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼

æ˜ ã£ãŸã‚ˆã­ï¼

æ¬¡ã€jekyllã„ãã¾ã™ã€‚

ã¾ãšjekyllã®ãƒ–ãƒ­ã‚°ä½œã‚Šã¾ã™ã€‚
jekyllã¯ã¾ãŸä»–ã®ã€é–‹ç™ºç”¨ã®ä»®æƒ³ç’°å¢ƒã§æ§‹ç¯‰ã—ã¦ã„ã¾ã™ã€‚ã“ã£ã¡ã®ã»ã†ãŒã‚„ã‚Šã‚„ã™ã„ã‹ã‚‰ã­ã€‚

```sh
sudo apt install jekyll
cd ~/tmp
jekyll new www
cd www
jekyll build
```

ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã­ã€‚
é–‹ç™ºç’°å¢ƒã‹ã‚‰ã€æœ¬ç•ªç’°å¢ƒã®å…ˆã»ã©nginxã®è¨­å®šã‚’ã—ãŸubuntuã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚

```sh
rsync --rsync-path="sudo rsync" -av -e 'ssh' _site/ user@192.168.99.100:/usr/share/nginx/html
```

ã§ã¯å…ˆç¨‹ã®onionãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

nginxã®ãƒšãƒ¼ã‚¸ã‹ã‚‰ã€welcomeãƒšãƒ¼ã‚¸ã«å¤‰ã‚ã£ãŸã‹ãªï¼Ÿ

ãŠã‚ã§ã¨ã†ğŸ‘ã“ã‚Œã§å›ã‚‚ãƒ€ãƒ¼ã‚¯ã‚¦ã‚§ãƒ–ãƒ–ãƒ­ã‚¬ãƒ¼ã ã‚ˆã€‚

## ã¾ã¨ã‚

ä»Šå›ã¯ãƒ€ãƒ¼ã‚¯ã‚¦ã‚§ãƒ–ã«ãƒ–ãƒ­ã‚°ã‚’ä½œã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚

ãœã²ã“ã®è¨˜äº‹ã‚’æ´»ç”¨ã—ã¦ãã‚Œã‚Œã°å¬‰ã—ãæ€ã„ã¾ã™ã€‚ã§ã¯ï¼ï¼
